{% extends "base.html" %}
{% block title %}Profile{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto space-y-8 animate-fade">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div>
      <h1 class="text-3xl font-bold text-slate-50">Profile</h1>
      <p class="text-slate-500 mt-1">Manage your account settings</p>
    </div>
    <a href="{{ url_for('user_dashboard') if user['role'] == 'user' else url_for('admin_dashboard') }}"
       class="text-sm text-brand-400 hover:text-brand-300 font-medium">
      ‚Üê Back to dashboard
    </a>
  </div>

  <div class="rounded-2xl bg-slate-900/60 border border-slate-800/80 overflow-hidden">
    <!-- Profile header -->
    <div class="p-6 border-b border-slate-800/80 bg-slate-800/30">
      <div class="flex items-center gap-4">
        <div class="h-16 w-16 rounded-2xl bg-gradient-to-br from-brand-500 to-brand-700 flex items-center justify-center text-2xl font-bold text-white shrink-0">
          {{ user['username'][0]|upper if user['username'] else '?' }}
        </div>
        <div>
          <h2 class="text-xl font-semibold text-slate-50">{{ user['username']|e }}</h2>
          <p class="text-slate-500 text-sm">{{ user['email']|e }}</p>
          <span class="inline-flex mt-2 px-2.5 py-0.5 rounded-lg text-xs font-medium {{ 'bg-brand-500/20 text-brand-300' if user['role'] == 'admin' else 'bg-slate-700/50 text-slate-400' }}">
            {{ user['role']|e }}
          </span>
        </div>
      </div>
    </div>

    <!-- Edit form -->
    <form method="POST" class="p-6 space-y-6">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <div>
        <label for="username" class="block text-sm font-medium text-slate-300 mb-2">Username</label>
        <input type="text" id="username" value="{{ user['username']|e }}" disabled
          class="w-full px-4 py-3 rounded-xl bg-slate-800/30 border border-slate-700 text-slate-400 cursor-not-allowed">
        <p class="mt-1 text-xs text-slate-500">Username cannot be changed.</p>
      </div>
      <div>
        <label for="email" class="block text-sm font-medium text-slate-300 mb-2">Email</label>
        <input type="email" id="email" name="email" required value="{{ user['email']|e }}"
          class="w-full px-4 py-3 rounded-xl bg-slate-800/50 border border-slate-700 text-slate-100 placeholder-slate-500 focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20 transition-all">
      </div>
      <div class="border-t border-slate-800/80 pt-6">
        <h3 class="text-sm font-semibold text-slate-200 mb-4">Change password</h3>
        <div class="space-y-4">
          <div>
            <label for="current_password" class="block text-sm font-medium text-slate-300 mb-2">Current password</label>
            <input type="password" id="current_password" name="current_password" required
              class="w-full px-4 py-3 rounded-xl bg-slate-800/50 border border-slate-700 text-slate-100 placeholder-slate-500 focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20">
          </div>
          <div>
            <label for="new_password" class="block text-sm font-medium text-slate-300 mb-2">New password (leave blank to keep)</label>
            <input type="password" id="new_password" name="new_password" minlength="8"
              class="w-full px-4 py-3 rounded-xl bg-slate-800/50 border border-slate-700 text-slate-100 placeholder-slate-500 focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"
              placeholder="8+ chars with upper, lower & number">
          </div>
          <div>
            <label for="confirm_password" class="block text-sm font-medium text-slate-300 mb-2">Confirm new password</label>
            <input type="password" id="confirm_password" name="confirm_password" minlength="8"
              class="w-full px-4 py-3 rounded-xl bg-slate-800/50 border border-slate-700 text-slate-100 placeholder-slate-500 focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20"
              placeholder="Re-type new password">
          </div>
        </div>
      </div>
      <button type="submit"
        class="w-full sm:w-auto px-6 py-3 rounded-xl font-semibold text-sm bg-gradient-to-r from-brand-500 to-brand-600 text-white shadow-lg shadow-brand-500/25 hover:shadow-brand-500/30 hover:from-brand-400 hover:to-brand-500 transition-all">
        Save changes
      </button>
    </form>
  </div>
</div>
{% endblock %}
